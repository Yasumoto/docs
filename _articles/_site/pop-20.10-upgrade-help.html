<h3 id="backup-your-files">Backup Your Files</h3>
<p>The upgrade process will leave your files intact, but it’s always a good idea to play it safe and create a backup of any important files. Please read our article on <a href="/articles/backup-files/">how to backup your files</a> for helpful instructions.</p>

<h3 id="fstab-error-message">FStab Error Message</h3>

<p>This can be caused by the <code class="language-plaintext highlighter-rouge">pop-upgrade</code> command checking for an <code class="language-plaintext highlighter-rouge">/etc/fstab</code> file and finding an entry that it does not understand. If you have manually added drives to your fstab, adding a ‘#’ to comment out the drive while the upgrade is ongoing should work.  You would then remove the comment after the upgrade is complete to have access to those drive paths again. To edit this file, run the following command in a terminal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo gedit /etc/fstab
</code></pre></div></div>
<p>For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/dev/disk/by-id/usb-ST1000LM_02123AD2-0:0-part1 /media/system76/game_drive auto nosuid,nodev,nofail,x-gvfs-show 0 0
</code></pre></div></div>

<p>would become:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#/dev/disk/by-id/usb-ST1000LM_02123AD2-0:0-part1 /media/system76/game_drive auto nosuid,nodev,nofail,x-gvfs-show 0 0
</code></pre></div></div>

<p>If it is showing by UUID, the example would change from:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/dev/disk/by-uuid/ed6c6976-973f-40e5-969b-9d4238fb7e00 /media/system76/ExtraDrive auto nosuid,nodev,nofail,x-gvfs-show 0 0
</code></pre></div></div>

<p>To:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#/dev/disk/by-uuid/ed6c6976-973f-40e5-969b-9d4238fb7e00 /media/system76/ExtraDrive auto nosuid,nodev,nofail,x-gvfs-show 0 0
</code></pre></div></div>

<p>After you have made the edit, save the file and start the upgrade again.</p>

<h3 id="repair-package-manager-after-failedincomplete-upgrade">Repair Package Manager after Failed/Incomplete Upgrade</h3>

<ol>
  <li>If you’re able to log in and have a graphical interface, let’s try running a set of commands in a terminal (click your activities menu and type ‘t’ for ‘terminal’) to clean up the installed packages:</li>
</ol>

<p><strong>If this is your first time running commands, just a heads up- after each command, press the enter key. When the system prompts you for your password, type it in the terminal and press the enter key. The password will not show in the terminal, but it is taking the password)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt clean
sudo apt update -m
sudo dpkg --configure -a
sudo apt install -f
sudo apt dist-upgrade
sudo apt autoremove --purge
</code></pre></div></div>

<p>If you are not able to get to the desktop to run those commands, try to get to a TTY (Ctrl+Alt+F5). Enter the username and password as requested and proceed with the commands above.</p>

<p>If you cannot access the desktop or TTY, we can run the package repair commands in Pop Recovery instead. To do this,</p>

<p>1A. Turn your computer off, then turn it back on and hold down the space bar immediately. In the menu that appears, select Pop!_OS Recovery, and let it boot.</p>

<p>1B. Once it boots, close out of the installation window or choose “Try Demo Mode” (be sure not to choose any install or repair options, as this could result in data loss).</p>

<p><strong>If you do not have a Pop Recovery option, you can create a live disk image of the OS and follow the next steps to mount the installed OS while running in a live disk. To create a live disk, use the instructions in the following <a href="/articles/live-disk">article</a>, then proceed to the next step.</strong></p>

<ol>
  <li>
    <p>Connect to your network</p>
  </li>
  <li>
    <p>Mount the installed OS and “chroot” into the main OS. Chroot or “change root” lets us run commands as if we were logged in normally.</p>
  </li>
</ol>

<p>To mount the OS, make note of what type of drive your OS is installed on. Is it an NVME or a SATA drive? You can run the following command to confirm:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo parted -ls
</code></pre></div></div>

<p>Look for the name of your main hard drive. It could be <code class="language-plaintext highlighter-rouge">/dev/sda</code> or <code class="language-plaintext highlighter-rouge">/dev/nvme0n1</code>, depending on if you have a standard SATA drive, or an NVMe drive, respectively. Input the following commands based on your drive type:</p>

<p><strong>If disk is encrypted, start with these first 3 commands using the correct drive name in the /dev filepath</strong>:</p>

<p><strong>For SATA Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/sda3 /mnt
</code></pre></div></div>

<p><strong>For NVMe Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/nvme0n1p3 /mnt
</code></pre></div></div>

<p>If the command fails and says <code class="language-plaintext highlighter-rouge">mount: /mnt: unknown filesystem type 'crypto_LUKS'</code>, then the hard drive has been encrypted, and additional commands are needed to unlock it.</p>

<p><strong>For SATA Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cryptsetup luksOpen /dev/sda3 cryptdata
sudo lvscan
sudo vgchange -ay
</code></pre></div></div>

<p><strong>For NVMe Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cryptsetup luksOpen /dev/nvme0n1p3 cryptdata
sudo lvscan
sudo vgchange -ay
</code></pre></div></div>
<p>Next we will mount the now decrypted drive:</p>

<p><strong>NOTE:</strong> Pay attention to what the cryptdata group is called. If it is named something other than ‘data-root’ then you will need to substitute the correct info into this next command. Make sure that -root is on the end.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/mapper/data-root /mnt
</code></pre></div></div>

<p>Next we will need to mount the required paths for the chroot to function.</p>

<p><strong>For SATA Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/sda1 /mnt/boot/efi
for i in /dev /dev/pts /proc /sys /run; do sudo mount -B $i /mnt$i; done
sudo cp -n /etc/resolv.conf /mnt/etc/
sudo chroot /mnt
</code></pre></div></div>

<p><strong>For NVMe Drives</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/nvme0n1p1 /mnt/boot/efi
for i in /dev /dev/pts /proc /sys /run; do sudo mount -B $i /mnt$i; done
sudo cp -n /etc/resolv.conf /mnt/etc/
sudo chroot /mnt
</code></pre></div></div>

<p><strong>If you get an error about the <code class="language-plaintext highlighter-rouge">/etc/resolv/conf</code> file being the same, you can safely ignore it.</strong></p>

<ol>
  <li>Once the installed OS is mounted, we can attempt to repair it by running the following commands:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt clean
sudo apt update -m
sudo dpkg --configure -a
sudo apt install -f
sudo apt dist-upgrade
sudo apt autoremove --purge
</code></pre></div>    </div>
  </li>
  <li>If there are no errors, run the next commands to exit the terminal and reboot.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exit
reboot
</code></pre></div></div>
