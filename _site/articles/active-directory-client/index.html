<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="theme-color" content="#574e4a">

    <title>Active Directory Domain - System76 Support</title>
    <meta property="og:title" content="Active Directory Domain - System76 Support">
    <meta itemprop="name" content="Active Directory Domain - System76 Support">
    <meta name="twitter:title" content="Active Directory Domain - System76 Support">

    <meta name="description" content="Learn how to join Pop!_OS to an Active Directory domain">
    <meta property="og:description" content="Learn how to join Pop!_OS to an Active Directory domain">
    <meta itemprop="description" content="Learn how to join Pop!_OS to an Active Directory domain">
    <meta name="twitter:description" content="Learn how to join Pop!_OS to an Active Directory domain">

    <meta name="keywords" content="Pop!_OS Security Linux Active Directory Authentication">

    
    <meta property="og:image" content="http://support.system76.com/images/system76.png" />
    <meta name="twitter:image:src" content="http://support.system76.com/images/system76.png">
    

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@system76">
    <meta name="twitter:creator" content="@system76">


    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://system76.com/images/touch-icon-iphone-retina.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://system76.com/images/touch-icon-ipad-retina.png">
    <link rel="touch-icon" sizes="196x196" href="https://system76.com/images/icon-196.png">
    <link rel="icon" sizes="196x196" href="https://system76.com/images/icon-196.png">

    <link rel="stylesheet" type="text/css" media="all" href="https://system76.com/stylesheets/app.css">
    <link rel="stylesheet" href="/css/main.css">

    <!--[if lt IE 10]><script>document.documentElement.className += " legacy";</script><![endif]-->

        <script>
        (function() {
            var _fbq = window._fbq || (window._fbq = []);
            if (!_fbq.loaded) {
                var fbds = document.createElement('script');
                fbds.async = true;
                fbds.src = '//connect.facebook.net/en_US/fbds.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(fbds, s);
                _fbq.loaded = true;
            }
        })();
        window._fbq = window._fbq || [];
        </script>

        <script src="//platform.twitter.com/oct.js" type="text/javascript"></script>

        <script>
        var fbSent = false;

        function facebookStatusChangeCallback(response) {
            if (response.status === 'connected' && fbSent) {
                window.oauthSuccess('facebook', response.authResponse.accessToken);
            }
        }

        function facebookCheckLoginState() {
            FB.getLoginStatus(function(response) {
                facebookStatusChangeCallback(response);
            });
        }

        function facebookLogin() {
            fbSent = true;
            FB.login(
                facebookCheckLoginState,
                {
                    scope: 'email'
                }
            );
        }

        window.fbAsyncInit = function() {
            FB.init({
                appId: '346948125501334',
                cookie: true,
                xfbml: true,
                version: 'v2.1'
            });

            FB.getLoginStatus(function(response) {
                facebookStatusChangeCallback(response);
            });
        };

        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        </script>

        <script>
        function githubLogin() {
            var gitHubWindow = popupCenter(
                "https://github.com/login/oauth/authorize?" +
                "client_id=dc1b6955f316f6f4633b" +
                "&scope=user,user:email",
                "GitHub"+Date.now(),
                1024,
                600
            );
        }
        </script>

        <meta name="google-signin-clientid" content="118911812273-tsqn79u4hm451chlbhm1gkkt63ttgoq9.apps.googleusercontent.com" />
        <meta name="google-signin-scope" content="email" />
        <meta name="google-signin-cookiepolicy" content="single_host_origin" />
        <script src="https://apis.google.com/js/client:platform.js?onload=googleRender" async defer></script>

        <script>
        function googleLogin() {
            gapi.auth.signIn({
                'callback': googleSigninCallback
            });
        }

        function googleSigninCallback(authResult) {
            if (authResult['status']['signed_in']) {
                if( authResult['status']['method'] == 'PROMPT' ) {
                    window.oauthSuccess("google", authResult['access_token']);
                }
            }
        }
        </script>

        <link href="https://cdn.rawgit.com/Lukas-W/font-linux/v0.5/assets/font-linux.css" rel="stylesheet">

</head>

  <body class="path-support">
    <div id="page-container">
        <header id="masthead" class="main">
	<nav>
		<a id="logo" class="home" href="https://system76.com"></a>

		<ul class="quick" id="nav-links">
			<li>
				<a id="link-contact" href="https://system76.com/contact" title="Contact">
					<i class="fa fa-comments"></i>
					Contact
				</a>
			</li>

			<li>
				<a id="link-support" href="https://support.system76.com" title="Support">
					<i class="fa fa-life-ring"></i>
					Support
				</a>
			</li>

			<li>
				<a id="link-account" href="https://system76.com/my-account" title="Account">
					<i class="fa fa-user"></i>
					Account
				</a>
			</li>
		</ul>

		<ul id="nav-links" class="categories">
			<li><a href="https://system76.com/laptops">Laptops</a></li>
			<li><a href="https://system76.com/desktops">Desktops</a></li>
			<li><a href="https://system76.com/desktops/meerkat">Mini</a></li>
			<li><a href="https://system76.com/servers">Servers</a></li>
			<li><a href="https://system76.com/pop">Pop!_OS</a></li>
		</ul>
	</nav>
</header>


  <header id="page-title">
    <div class="row">
      <h1 class="small-12 columns greeting">
        <a href="/" title="Back to Support"><i class="fa fa-arrow-left"></i></a>
        Active Directory Domain
        <a href="https://github.com/system76/docs/edit/master/_articles/active-directory-client.md" class="button"><i class="fa fa-github"></i> Edit on GitHub</a>
      </h1>
    </div>
  </header>


        <div class="row">
    <div class="small-12 small-centered medium-10 large-8 columns">
        <h1 id="join-an-active-directory-domain">Join an Active Directory Domain</h1>

<p>Pop!_OS and Ubuntu can be joined to an Active Directory domain, which allows users to log in with their existing network credentials.</p>

<ol>
  <li>
    <p>Install the necessary packages:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>apt <span class="nb">install </span>sssd heimdal-clients msktutil
</code></pre></div>    </div>

    <p>While installing those packages, you will be prompted for the following information. These are sample responses. Our domain is called “system76.local” and our Active Directory server is called “adserver” in this example:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Forest name: SYSTEM76
 Domain controller <span class="nb">hostname</span>: ADSERVER.system76.local
 Administrative server <span class="k">for </span>your Kerberos realm: ADSERVER.system76.local
</code></pre></div>    </div>
  </li>
  <li>
    <p>Move the default Kerberos configuration file to a backup, and create a fresh file to use:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo mv</span> /etc/krb5.conf /etc/krb5.conf.default
 <span class="nb">sudo </span>nano /etc/krb5.conf
</code></pre></div>    </div>

    <p>Edit the /etc/krb5.conf file with the following contents:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [libdefaults]
 default_realm = SYSTEM76.LOCAL
 rdns = no
 dns_lookup_kdc = true
 dns_lookup_realm = true

 [realms]
 SYSTEM76.LOCAL = {
 kdc = ADSERVER.system76.local
 admin_server = ADSERVER.system76.local
 }
</code></pre></div>    </div>
  </li>
  <li>
    <p>Initialize Kerberos and generate a keytab file. The first command requires the username of a domain administrator, and our computer’s hostname is “pop-os” in this example:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> kinit administrator
 klist
 msktutil -N -c -b 'CN=COMPUTERS' -s POP-OS/pop-os.system76.local -k my-keytab.keytab ‑‑computer-name POP-OS ‑‑upn POP-OS$ ‑‑server adserver.system76.local ‑‑user-creds-only
 msktutil -N -c -b 'CN=COMPUTERS' -s POP-OS/pop-os -k my-keytab.keytab ‑‑computer-name POP-OS ‑‑upn POP-OS$ ‑‑server adserver.system76.local ‑‑user-creds-only
 kdestroy
</code></pre></div>    </div>
  </li>
  <li>
    <p>Move the keytab to the /etc/sssd directory, and configure SSSD:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo mv </span>my-keytab.keytab /etc/sssd/my-keytab.keytab
 <span class="nb">sudo </span>nano /etc/sssd/sssd.conf
</code></pre></div>    </div>

    <p>The SSSD configuration file should contain the following:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [sssd]
 services = nss, pam
 config_file_version = 2
 domains = system76.local

 [nss]
 entry_negative_timeout = 0
 #debug_level = 5

 [pam]
 #debug_level = 5

 [domain/system76.local]
 #debug_level = 10
 enumerate = false
 id_provider = ad
 auth_provider = ad
 chpass_provider = ad
 access_provider = ad
 dyndns_update = false
 ad_hostname = pop-os.system76.local
 ad_server = adserver.system76.local
 ad_domain = system76.local
 ldap_schema = ad
 ldap_id_mapping = true
 fallback_homedir = /home/%u
 default_shell = /bin/bash
 ldap_sasl_mech = gssapi
 ldap_sasl_authid = POP-OS$
 krb5_keytab = /etc/sssd/my-keytab.keytab
 ldap_krb5_init_creds = true
</code></pre></div>    </div>

    <p>After saving, set the appropriate permissions on that configuration file:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo chmod </span>0600 /etc/sssd/sssd.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure PAM:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>nano /etc/pam.d/common-session
</code></pre></div>    </div>

    <p>Look for the line that contains “session required pam_unix.so” and add this line immediately below it:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> session required pam_mkhomedir.so skel=/etc/skel umask=0077
</code></pre></div>    </div>

    <p>After saving that file, restart SSSD:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>systemctl restart sssd
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add the domain administrator to the local sudo group:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>adduser administrator <span class="nb">sudo</span>
</code></pre></div>    </div>

    <p>Then, test a login with the domain administrator:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> su <span class="nt">-l</span> administrator
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reboot the computer. At the login screen, you can click the “Not listed?” link, and type the username of any domain user. After logging in with a domain user for the first time, that user will appear on the login screen’s user list.</p>

    <p><img src="/images/active-directory-client/login-screen-not-listed.png" alt="Login Screen" /></p>
  </li>
</ol>

    </div>
    <div class="small-12 small-centered medium-10 large-8 columns timestamp">
        <p>Article last modified: 2021-06-04</p>
    </div>
</div>

    </div>
    <footer id="foot">
    <div id="foot-links" class="row">
        <ul class="small-5 medium-2 columns">
            <li><a href="https://system76.com/contact">Contact</a></li>
            <li><a href="https://system76.com/support">Support</a></li>
            <li><a href="https://system76.com/about">About Us</a></li>
            <li><a href="http://blog.system76.com">Blog</a></li>
            <li><a href="https://system76.com/careers">Careers</a></li>
        </ul>
        <ul class="small-7 medium-4 columns">
            <li><a href="https://system76.com/shipping">Shipping Information</a></li>
            <li><a href="https://system76.com/warranty">Warranty &amp; Returns</a></li>
            <li><a href="https://system76.com/privacy">Privacy Policy</a></li>
            <li><a href="https://system76.com/disclaimer">Disclaimer</a></li>
            <li><a href="https://system76.com/terms">Terms &amp; Conditions</a></li>
        </ul>
        <ul id="social-links" class="small-12 medium-6 columns">
            <li><a href="https://www.facebook.com/system76/"><i class="fa fa-facebook"></i></a></li>
            <li><a href="https://twitter.com/system76/"><i class="fa fa-twitter"></i></a></li>
            <li><a href="https://www.pinterest.com/system76/"><i class="fa fa-pinterest"></i></a></li>
        </ul>
    </div>
    <div id="copyright" class="text-center">Copyright &copy; 2021 System76, Inc. </div>

    <div class="disclaimer text-center">* All financing prices are based on the advertised price at 10% APR paid over 12 months.</div>

    <div id="trademarks" class="text-center">Intel, the Intel Logo, Intel Core, and Xeon are trademarks of Intel Corporation in the U.S. and/or other countries.</div>
</footer>

<script src="https://system76.com/scripts/thinkbott1k.js"></script>

<!--[if lt IE 10]>
<div id="legacy-warning">
<h1>System76 is built on modern web technologies your browser doesn&rsquo;t support.</h1>
<p>This version of Internet Explorer is out of date and may contain bugs or security vulnerabilities. Please <a href="http://browsehappy.com/">upgrade</a> to IE 11 or an alternative web browser.</p>
<p>If you have questions about an order or require support, feel free to <a href="/contact">contact us</a>.</p>
<div id="legacy-warning-buttons">
<a href="#" onClick="document.getElementById('legacy-warning').style.display = 'none';">Dismiss</a>
<a class="primary" href="http://browsehappy.com/">Learn More</a>
</div>
</div>
<![endif]-->

  </body>
</html>
